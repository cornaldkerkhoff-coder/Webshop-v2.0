<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Product – Ecomurce</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f5f5f7;
      color: #111827;
    }
    header {
      background: #111827;
      color: #f9fafb;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header a {
      color: #e5e7eb;
      text-decoration: none;
      margin-left: 1rem;
      font-size: 0.95rem;
    }
    header a:hover { color: #ffffff; }

    main { padding: 1.5rem 2rem 3rem; max-width: 1100px; margin: 0 auto; }

    .breadcrumb {
      font-size: 0.85rem;
      margin-bottom: 1rem;
      color: #6b7280;
    }
    .breadcrumb a { color: inherit; text-decoration: none; }
    .breadcrumb a:hover { text-decoration: underline; }

    .product-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 2rem;
      align-items: flex-start;
    }
    .product-image {
      background: #ffffff;
      padding: 1rem;
      border-radius: 1rem;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
    }
    .product-image img {
      width: 100%;
      border-radius: 0.75rem;
      object-fit: cover;
      max-height: 420px;
    }

    .product-info h1 {
      margin-top: 0;
      margin-bottom: 0.25rem;
    }
    .brand {
      font-size: 0.9rem;
      color: #6b7280;
    }
    .price {
      margin-top: 0.75rem;
      font-size: 1.5rem;
      font-weight: 700;
    }
    .category {
      font-size: 0.8rem;
      margin-top: 0.25rem;
      color: #4b5563;
    }
    .stock {
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    .stock.in_stock { color: #059669; }
    .stock.low_stock { color: #d97706; }
    .stock.out_of_stock { color: #b91c1c; }

    .long-description {
      margin-top: 1rem;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .buy-box {
      margin-top: 1.5rem;
      background: #ffffff;
      border-radius: 0.75rem;
      padding: 1rem;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.04);
    }
    .buy-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .buy-row label {
      font-size: 0.9rem;
    }
    .buy-row input[type="number"] {
      width: 80px;
      padding: 0.3rem 0.4rem;
      border-radius: 0.375rem;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
    }
    .button-primary {
      display: inline-block;
      padding: 0.6rem 1.1rem;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #f9fafb;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
    }
    .button-primary:hover { background: #020617; }

    .meta {
      margin-top: 1rem;
      font-size: 0.85rem;
      color: #6b7280;
    }
    .meta a {
      color: inherit;
      text-decoration: none;
    }
    .meta a:hover { text-decoration: underline; }

    @media (max-width: 768px) {
      header { padding: 0.75rem 1rem; }
      main { padding: 1rem; }
      .product-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">Ecomurce</div>
    <nav>
      <a href="Index.html">Home</a>
      <a href="product.html">Productoverzicht</a>
      <a href="winkelwagen.html">Winkelwagen</a>
      <a href="account.html">Account</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main>
    <div class="breadcrumb">
      <a href="Index.html">Home</a> › <a href="product.html">Producten</a> › <span id="breadcrumb-name">Product</span>
    </div>

    <div id="product-container">
      Laden...
    </div>
  </main>

  <script>
    function getSlugFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('slug');
    }

    function formatPrice(value, currency) {
      try {
        return new Intl.NumberFormat('nl-NL', {
          style: 'currency',
          currency: currency || 'EUR'
        }).format(value);
      } catch (e) {
        return value.toFixed(2) + ' ' + (currency || 'EUR');
      }
    }

    function loadCart() {
      try {
        return JSON.parse(localStorage.getItem('cart') || '[]');
      } catch {
        return [];
      }
    }

    function saveCart(cart) {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function addToCart(product, quantity) {
      const qty = Math.max(1, quantity || 1);
      const cart = loadCart();
      const existing = cart.find(item => item.slug === product.slug);

      if (existing) {
        existing.quantity += qty;
      } else {
        cart.push({
          slug: product.slug,
          name: product.name,
          price_retail: product.price_retail,
          price_currency: product.price_currency,
          main_image_url: product.main_image_url,
          quantity: qty
        });
      }

      saveCart(cart);
      alert('Toegevoegd aan je winkelwagen.');
    }

    async function loadProduct() {
      const container = document.getElementById('product-container');
      const slug = getSlugFromUrl();

      if (!slug) {
        container.textContent = 'Geen product opgegeven.';
        return;
      }

      try {
        const res = await fetch('products.json');
        const products = await res.json();
        const product = products.find(p => p.slug === slug);

        if (!product) {
          container.textContent = 'Product niet gevonden.';
          return;
        }

        document.getElementById('breadcrumb-name').textContent = product.name;

        const wrapper = document.createElement('div');
        wrapper.className = 'product-layout';

        const imageCol = document.createElement('div');
        imageCol.className = 'product-image';
        const img = document.createElement('img');
        img.src = product.main_image_url || 'https://via.placeholder.com/600x400?text=Product';
        img.alt = product.name;
        imageCol.appendChild(img);
        wrapper.appendChild(imageCol);

        const infoCol = document.createElement('div');
        infoCol.className = 'product-info';

        const brand = document.createElement('div');
        brand.className = 'brand';
        brand.textContent = product.brand ? product.brand : 'Geen merk';
        infoCol.appendChild(brand);

        const title = document.createElement('h1');
        title.textContent = product.name;
        infoCol.appendChild(title);

        const price = document.createElement('div');
        price.className = 'price';
        price.textContent = formatPrice(product.price_retail, product.price_currency);
        infoCol.appendChild(price);

        const category = document.createElement('div');
        category.className = 'category';
        category.textContent = product.category + (product.subcategory ? ' • ' + product.subcategory : '');
        infoCol.appendChild(category);

        const stock = document.createElement('div');
        stock.className = 'stock ' + (product.stock_status || 'in_stock');
        const stockLabel = product.stock_status === 'out_of_stock'
          ? 'Niet op voorraad'
          : product.stock_status === 'low_stock'
          ? 'Beperkt op voorraad'
          : 'Op voorraad';
        stock.textContent = stockLabel + (product.stock_quantity ? ' (' + product.stock_quantity + ' st.)' : '');
        infoCol.appendChild(stock);

        const longDesc = document.createElement('div');
        longDesc.className = 'long-description';
        longDesc.textContent = product.long_description || product.short_description;
        infoCol.appendChild(longDesc);

        const buyBox = document.createElement('div');
        buyBox.className = 'buy-box';

        const qtyRow = document.createElement('div');
        qtyRow.className = 'buy-row';

        const qtyLabel = document.createElement('label');
        qtyLabel.setAttribute('for', 'qty');
        qtyLabel.textContent = 'Aantal:';
        qtyRow.appendChild(qtyLabel);

        const qtyInput = document.createElement('input');
        qtyInput.type = 'number';
        qtyInput.id = 'qty';
        qtyInput.min = '1';
        qtyInput.value = '1';
        qtyRow.appendChild(qtyInput);

        buyBox.appendChild(qtyRow);

        const btn = document.createElement('button');
        btn.className = 'button-primary';
        btn.textContent = 'Toevoegen aan winkelwagen';
        btn.addEventListener('click', () => {
          const q = parseInt(qtyInput.value, 10) || 1;
          addToCart(product, q);
        });
        buyBox.appendChild(btn);

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `
          Leverancier: <strong>${product.supplier_name || 'N.t.b.'}</strong><br>
          Richtprijs inkoop: ${product.supplier_price ? formatPrice(product.supplier_price, product.supplier_currency) : 'n.n.b.'}<br>
          <span style="opacity:0.75;">(Controleer inkoopprijs en voorraad altijd in het leverancier-portaal voordat je bestelt.)</span>
        `;
        buyBox.appendChild(meta);

        infoCol.appendChild(buyBox);

        wrapper.appendChild(infoCol);
        container.innerHTML = '';
        container.appendChild(wrapper);

      } catch (err) {
        console.error(err);
        container.textContent = 'Er ging iets mis bij het laden van het product.';
      }
    }

    document.addEventListener('DOMContentLoaded', loadProduct);
  </script>
</body>
</html>
